<!-- banner -->
<div class="container-gys">
  <div class="artist-banner mb-3" style="background-image: linear-gradient(rgba(0,0,0,0.2),rgba(0,0,0,0.2)), url('<%= cl_image_path @project.photo.key %>');">
    <div class="artist-banner-name">
      <h3><%= User.find(@project.user_id).artist_name.capitalize %></h3>
      <p><%= @project.name  %></p>
    </div>
    <div class="artist-banner-genre">
      <p><%= Product.find_by(project_id: @project.id).genre %></p>
    </div>
    <div class="artist-banner-token">
      <h2><%= @project.number_of_tokens - @project.number_of_transactions(@project)%></h2>
      <p>tokens left</p>
    </div>
  </div>

<!-- project information -->
  <div class="artist-project-info">
    <div class="row">
      <!-- project description & music player: left part -->
      <div class="col col-sm-6">
        <h2 class="text-secondary">Project description</span></h2>
        <p class="opacity-75"><%= @project.description %></p> 
        <!-- spotify infos -->
        <% @spotify_id = @project.products.first%>
        <iframe src="https://open.spotify.com/embed/album/<%=@spotify_id.spotify_id%>" width="100%" height="250" 
        frameborder="0" allowtransparency="true" allow="encrypted-media" style="border-radius:8px"></iframe>
        <!-- youtube infos, video is launched automatically but muted -->
        <% @youtube_id = @project.tracks.where.not(youtube_id: nil).first%>
        <% if @youtube_id != nil %>
          <iframe id="ytplayer" type="text/html" width="100%" height="350" allowfullscreen style="border-radius:8px"
          src="http://www.youtube.com/embed/<%=@youtube_id.youtube_id%>?rel=0&amp;autoplay=1&mute=1"
          frameborder="0"></iframe>
        <% end %>
      </div>
   
      <!-- empty middle column -->
      <div class="col col-sm-1">
      </div>

      <!-- project financial information: right part -->
      <div class="col col-sm-5">
        <h2 class="text-secondary mb-3">Financial information</h2>
        <!-- project funding status -->
        <p class="text-primary m-0 border-bottom"><i class="fas fa-coins text-secondary"></i>  Project funding status</p>

        <div class="d-flex mt-3 mb-0 align-items-center">
          <% amount_invested = @project.total_amount_invested(@project).to_i %>
          <p class="text-primary fw-bold fs-4 mb-0 me-2"><%= number_with_delimiter(amount_invested, :delimiter => ',') %> $</p>
          <% total_amount_available = @project.total_amount_available(@project).to_i %>
          <p class="mb-0">invested on <%= number_with_delimiter(total_amount_available, :delimiter => ',')%> $ goal</p>
        </div>
        <div class="progress my-3">
         <div class="progress-bar" role="progressbar" style="width: <%= (( @project.total_amount_invested(@project).to_f / @project.total_amount_available(@project).to_f) * 100).round %>%;" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"><%= ((@project.total_amount_invested(@project).to_f / @project.total_amount_available(@project).to_f) * 100).round %>%</div>
        </div>

        <div class="artist-project-info-financial">
          <div class="text-center bg-secondary border border-secondary rounded p-2 w-25">
            <p class="m-0 text-white fw-bold fs-5"><%= number_with_delimiter(@project.unit_price.to_i, :delimiter => ',')%> $</p>
            <p class="m-0 text-white" style="font-size:12px">per token</p>
          </div>
          <div class="text-center border border-primary rounded p-2 ms-3 w-25">
            <p class="m-0 text-primary fw-bold fs-5"><%= @project.number_of_tokens%></p>
            <p class="m-0" style="font-size:12px">tokens total</p>
          </div>
          <div class="text-center rounded p-2 ms-3 w-25" style="border:1px solid #f9bc0b">
            <p class="m-0 fw-bold fs-5" style="color:#f9bc0b"><%= @project.number_of_transactions(@project) %></p>
            <p class="m-0" style="font-size:12px">tokens purchased</p>
          </div>
        </div>

        <!-- button for payment (stripe) -->
        <p>
          <%= form_tag project_transactions_path(@project, Transaction.new), method: :post do %>
            <%= hidden_field_tag 'token_id', @project.tokens.map {|token| token if !token.bought?}.compact.first.id %>
            <%= submit_tag 'Buy token', class: 'btn btn-secondary' %>
          <% end %>
        </p>

        <!-- investment distribution -->
        <p class="text-primary mt-4 border-bottom"><i class="fas fa-hand-holding-usd text-secondary"></i> Investment distribution</p>
        <%= pie_chart @shares, legend: "right", colors: ["#6768AB", "#26216", "#f9bc0b"], suffix: '%', width: "400px", height: "150px" %>

        <!-- previsional information -->
        <p class="text-primary mt-4 border-bottom"><i class="fas fa-chart-line text-secondary"></i> Previsional information per year</p>
        <div class="artist-project-info-financial">
          <div class="text-left p-2 w-25">
            <p class="m-0 text-secondary fw-bold fs-5"> <%= number_with_delimiter(@project.project_revenue(@project).round, :delimeter => ',')  %> $</p>
            <p class="m-0" style="font-size:12px">estimated annual revenue</p>
          </div>
          <div class="text-left p-2 ms-3 w-25">
            <p class="m-0 text-primary fw-bold fs-5"><%= number_with_delimiter(@project.expected_audio_streams_year, :delimiter => ',')%></p>
            <p class="m-0" style="font-size:12px">audio streams</p>
          </div>
          <div class="text-center p-2 ms-3 w-25">
            <p class="m-0 fw-bold fs-5" style="color:#f9bc0b"><%= number_with_delimiter(@project.expected_video_streams_year, :delimiter => ',')%></p>
            <p class="m-0" style="font-size:12px;">video streams</p>
          </div>
        </div>

        <!-- other information -->
        <p class="text-primary mt-4 border-bottom">Other information</p>
        <p>Release date: <%= @project.release_date.strftime("%B %d, %Y") %></p>
        <p>Distributor: <%= @project.distributor %></p>
      </div>
    </div>
  </div>
  <!-- link to index -->
  <i class="fas fa-backward text-primary mt-5"></i> <%= link_to "Return to projects", projects_path, class: "text-decoration-none" %>
</div>
